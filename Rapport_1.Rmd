---
output: pdf_document
header-includes:
- \usepackage[french]{babel}
- \usepackage{float}
- \usepackage{titling}
---
\begin{titlingpage}
  \rightline{Équipe 2}
  \centering
  \Large
  Travail fait par \\
  \vspace{1cm}
  \text{Matis Brassard-Verrier (111 182 740) }\\
  \text{Alyson Marquis (111 183 605)}\\
  \text{Alexis Picard (111 182 200)}\\
  \text{Samuel Provencher (111 181 794)}\\
  \vfill
  \Large
  Apprentissage statistique en actuariat \\
  \vspace{0.5cm}
  \text{ACT-3114}
  \vfill
  \Large
  Rapport 1\\
  \vfill
  \Large
  Présenté à\\
  \vspace{0.5cm}
  \text{Marie-Pier Côté}
  \vfill
  \Large
  École d'actuariat\\
  \text{Université Laval}\\
  \text{27 février 2020}
\end{titlingpage}

\tableofcontents
\newpage
```{r echo=FALSE, message=FALSE, warning=FALSE}
donnees <- read.csv("kc_house_data.csv")

donnees <- donnees[!donnees$bathrooms == 0,] #10 cas
donnees <- donnees[!donnees$bedrooms == 0,] #13 cas
#6 cas ont bedrooms = 0 et bathrooms = 0
#Si on considère que c'est des maisons/jumelé, on trouve ça peu logique de conserver les 6 cas sans chambres (s'il y avait appart, ça pourrait faire du sens)

#suppression 33 chambres
donnees <- donnees[!donnees$bedrooms == 33,]

#suppression sqft_living (redondance), id et zipcode
donnees <- donnees[,-c(which(colnames(donnees)=="sqft_living"), which(colnames(donnees)=="id"),
                       which(colnames(donnees)=="zipcode"))]

#separation champs de la date
donnees$date <- substr(donnees$date,1,8)
annee <- substr(donnees$date,1,nchar(donnees$date)-4)
mois <- substr(donnees$date,nchar(donnees$date)-3,nchar(donnees$date)-2)
jour <- substr(donnees$date, nchar(donnees$date)-1, nchar(donnees$date))

#changement format date
donnees$date <- as.POSIXct(paste(annee,mois,jour,sep="-"), format="%Y-%m-%d", tz="UTC")

# facteur 0-1 pour la reno
donnees$reno <- (donnees$yr_renovated==0)*1

#creation de la variable age
donnees$age <- ifelse(as.numeric(annee) - donnees$yr_built >= 0, as.numeric(annee) - donnees$yr_built, 0) #cap à 115

#lat et long, on prendra la heat map
library(ggmap)
register_google(key = "AIzaSyDR2ob6a6HSgsBhZkN -k0QNVeJT3uio4Wg") 

map<-get_map(location = c(left = min(donnees$long), bottom = min(donnees$lat), right = max(donnees$long), top = max(donnees$lat)))

xmin <-  -122.4
xmax <-  -122
ymin <-  47.5
ymax <-  47.72

#Removed 2 rows containing missing values (geom_tile). ???

donnees$expensive_area <- sapply(1:nrow(donnees),
    function(i) as.numeric(donnees$lat[i] >= ymin & donnees$lat[i] <= ymax & donnees$long[i] >= xmin & donnees$long[i] <= xmax))
```
\section{Introduction}
Dans le cadre du travail, le prix de vente des maisons dans la région de Seattle (King County, USA) sera modélisé en utilisant de nombreuses caractéristiques ayant une incidence sur la valeur d'une maison. Le prix de vente d'une maison est une valeur positive évaluée en dollars américains. Cette valeur modélisée pourrait être utile pour différentes raisons. Comme la somme assurée d'une maison a un lien très fortement proportionnel à son prix de vente, une compagnie d'assurance pourrait être intéressée de modéliser le prix de vente de maisons dans des nouveaux développements immobiliers afin de tenter de prédire les futures soumissions d'assurance habitation et d'offrir des offres personnalisées aux acheteurs de ces nouvelles maisons. Dans un autre contexte, au niveau de la gestion des risques, certains assureurs ont un portefeuille de prêts hypothécaires ou utilisent des produits dérivés sur prêts hypothécaires pour se couvrir du risque (*hedging*). Ainsi, il pourrait être intéressant d'avoir une estimation des montants de prêts hypothécaires dans une région donnée en se basant sur le prix de vente des maisons afin de mieux gérer le risque de la compagnie. La pertinence de trouver cette variable qu'est le prix de vente des maisons devient alors fort intéressante. Le jeu de données utilisé sera le suivant : [kc_house_sales (House sales in King County, USA)](https://www.kaggle.com/harlfoxem/housesalesprediction). Il contient de nombreuses variables explicatives qui seront analysées dans la prochaine section. **Biographie pour la source**

\newpage
\section{Analyse exploratoire des données}
Tout d'abord, afin de bien comprendre la base de données choisie, une analyse exploratoire des données est nécessaire. La présente section traite des erreurs décelées dans le jeu de données et fournit des informations pertinentes sur les variables exogènes ainsi que sur la variable réponse sous forme d'une analyse univariée et bivariée.

\subsection{Traitement des erreurs}
La visualisation des données à l'étude a permis de déceler quelques erreurs. Tout d'abord, $10$ observations avaient un nombre de salle de bain égal à $0$. Étant donné qu'il est impossible d'avoir une maison sans salle de bain et que ces observations représentent qu'un faible pourcentage du jeu de données, il a été convenu de supprimer ces $10$ observations. Après avoir enlevé ces $10$ observations, il a été remarqué que $6$ maisons comptaient $0$ chambre. En analysant de plus près ces cas, il a été possible de constater que toutes les autres colonnes étaient remplies, donc il ne s'agit pas de données manquantes. De plus, comme ces données contenaient toutes un terrain et qu'elles représentaient une faible proportion des données, il a été décidé de les enlever. En outre, une observation avait $33$ chambres. En se fiant à l'aire habitable de la maison ainsi qu'aux nombre de salles de bain de cette maison, il a été convenu que le nombre de chambres avait subi une erreur de frappe. Puisqu'il était impossible de déterminer avec certitude le véritable nombre de chambres de la maison, il a été décidé de simplement retirer cette observation du jeu du données. En effet, comme nous avons un nombre considérable d'entrées dans la base de données (plus de 21000), les conséquences d'enlever une seule entrée de donnée fautive sont minimes. Il a aussi été envisagé d'imputer stochastiquement la donnée manquante, mais il a été réalisé que les tests statistiques pour déterminer un patron de non-réponse ne sont pas concluants lorsqu'on a uniquement une observation manquante sur plus de 21000 observations.


\subsection{Analyse univariée}
La base de données initiales comptaient $20$ variables explicatives. Or, certaines de ces variables n'étaient pas pertinentes dans la modélisation du prix de vente des maisons. Ainsi, $2$ variables explicatives ont été retirées du jeu de données, soit le numéro d'identification de la vente (*ID*) et le code postal (*zipcode*). Le code postal a été retiré, car le jeu de données contient d'autres variables plus précises sur la localisation des différentes maisons. De plus, la variable *Date* a été mise sous le format suivant : année-jour-mois. Voici d'ailleurs un tableau qui présente les variables explicatives retenues ainsi qu'une brève description de celles-ci.

|   Variables explicatives |     Descriptions                                                    |      
| :----------------------: |:-------------------------------------------------------------------:| 
|         Date             |  Date de la vente                                                   |     
|         Bedrooms         |  Nombres de chambres                                                |     
|         Bathrooms        |  Nombres de salles de bain ($0.5$ lorsqu'il n'y pas de douche)      |     
|         Sqft_living      |  Superficie habitable en pieds carrés                              | 
|         Sqft_lot         |  Superficie du terrain en pieds carrés                            | 
|         Floors           |  Nombre d'étages                                                    |  
|         Waterfront       |Indique si la maison a une vue sur l'eau ($1$ si oui, $0$ autrement) |     
|         View             |  Qualité de la vue extérieure allant de $0$ à $4$                   |     
|         Condition        | Condition de la maison allant de $1$ à $5$                          |     
|         Grade            |Qualité de la contrustion et de la conception allant de $1$ à $13$   | 
|         Sqft_above       |  Superficie habitable au-dessus du niveau du sol en pieds carrés    | 
|         Sqft_basement    |  Superficie habitable du sous-sol en pieds carrés                   |         
|         Yr_built         |  Année de construction                                              | 
|         Yr_renovated     |  Année de rénovation ($0$ si jamais rénovée)                        | 
|         Lat              |  Latitude                                                           | 
|         Long             |  Longitude                                                          | 
|         Sqft_living15    | Superficie habitable moyenne en pieds carrés des 15 plus proches voisins |   
|         Sqft_lot15       |  Superficie moyenne du terrain en pieds carrés des 15 plus proches voisins | 


Pour poursuivre, le tableau ci-dessous présente les caractéristiques des variables explicatives. blabla

![](caracteristiques.png){width="100%"}

Maintenant, analysons de plus près certaines de ces variables.
\newline
Le graphique suivant présente la densité de la variable *Date*.
```{r echo=FALSE, message=FALSE,fig.pos='H', fig.height=3, fig.width=4, fig.align="center"}
library(gridExtra)
library(ggplot2)

date <- ggplot(donnees, aes(x=date)) + geom_density() +
  ggtitle("Distribution des ventes de maisons dans l'année") +
  xlab("Date") + ylab("Densité") +
  theme_bw() + #asymétrie
  theme(plot.title = element_text(hjust = 0.5, size = 10), axis.title = element_text(size=8))
   

grid.arrange(date ,nrow = 1, ncol=1)

```
Il est possible de constater qu'il semble y avoir un effet de saisonnalité dans la vente de maisons. En effet, l'été semble être une période où il y a beaucoup de ventes de maisons tandis que l'hiver semble être une période où la vente de maisons est moins fréquente.
\newline
Le graphique suivant illustre la distribution de l'année de construction.

```{r echo=FALSE, message=FALSE,fig.pos='H', fig.height=3, fig.width=4, fig.align="center"}

year <- ggplot(donnees, aes(x=yr_built)) + geom_density() +
  ggtitle("Distribution des années de construction") +
  xlab("Année de construction") + ylab("Densité") +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5, size = 10), axis.title = element_text(size=8))

          
grid.arrange(year ,nrow = 1, ncol=1)

```

Tout d'abord, il est possible de constater que la base de données contient plus de maisons récentes que de vieilles maisons. On semble remarquer $2$ augmentations majeures sur le graphique. En effet, il y a une hausse vers les années $1950$, puis une seconde vers le début des années $2000$. De plus, on constate une légère concentration de maisons construites en $1900$. Plus précisément, $87$ maisons ont été construites en $1900$.



\subsubsection{Variable réponse}
```{r echo=FALSE, message=FALSE,fig.pos='H', fig.height=3, fig.width=6, fig.align="center"}
library(gridExtra)

#https://stackoverflow.com/questions/30026887/plot-title-at-bottom-of-plot-using-ggplot2 pour mettre en-dessous

pri <- ggplot(donnees, aes(x=price/1000000)) + geom_density() + ##Pour que le pas de graduation soit beau
  ggtitle("Distribution du prix de vente des maisons") +
  xlab("Prix de vente des maisons (M$)") + ylab("Densité") +
  theme_bw() + #asymétrie
  theme(plot.title = element_text(hjust = 0.5, size = 7), axis.title = element_text(size=6))

Lpri <- ggplot(donnees, aes(x=log(price))) + geom_density() + 
  ggtitle("Distribution du logarithme du prix de vente des maisons") +
  xlab("Logarithme du prix de vente des maisons") + ylab("Densité") +
  theme_bw() + #log pour variable réponse est mieux
  theme(plot.title = element_text(hjust = 0.5, size = 7), axis.title = element_text(size=6))

grid.arrange(pri, Lpri ,nrow = 1, ncol=2)

```
Lorsqu'on regarde le graphique de gauche, où aucune transformation logarithmique n'a été effectué sur la variable du prix, il possible de remarquer que la distribution a une forte asymétrie à droite. Cela a pour effet de décaler la distribution à gauche de la médiane et d'étaler la queue de la distribution vers la droite. Ainsi, dans cette représentation graphique, un grand nombre d'observation est regroupé dans des prix plus faibles.

Pour pallier à cette asymétrie, la transformation logarithmique a été effectué sur la variable réponse. Le résultat est présenté sur le graphique de droite. Il est possible de constater que la distribution dans ce graphique est symétrique et qu'elle s'approche de la forme d'une loi normale. Ainsi, il sera plus facile de modéliser le logarithme et d'analyser les résultats.


\subsection{Analyse bivariée}
\newpage
\subsubsection{Heatmap}
```{r echo=FALSE, message=FALSE,warning=FALSE,fig.pos='H', fig.height=3, fig.width=9, fig.align="center"}

library(ggmap)
register_google(key = "AIzaSyDR2ob6a6HSgsBhZkN -k0QNVeJT3uio4Wg") 

map<-get_map(location = c(left = min(donnees$long), bottom = min(donnees$lat), right = max(donnees$long), top = max(donnees$lat)))

ggmap(map, extent = "device") + stat_summary_2d(data = donnees ,
                                                aes(x = long, y = lat, z = log(price)),
                                                fun = mean, alpha = 0.6, bins = 100) + 
    scale_fill_gradient(name = "Log(Price)", low = "green", high = "red") +
    annotate("rect", xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax, colour="black", lty = 1, lwd = 1.3, alpha = 0) +
    annotate("text", x= -122.2, y = 47.6, label = "Zone urbaine") +
  ggtitle("King County, USA") +
  theme(plot.title = element_text(hjust = 0.5))


```

\subsubsection{Date en fonction du logarithme du prix}
```{r echo=FALSE, message=FALSE,fig.pos='H', fig.height=3, fig.width=6, fig.align="center"}
library(gridExtra)

Lpri <- ggplot(donnees, aes(x=date, y=log(price))) + geom_point(alpha=0.1) + 
  ggtitle("Logarithme du prix de vente des maisons selon le moment de l'année") +
  xlab("Moment de l'année") + ylab("Logarithme du prix de vente") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size = 10), axis.title = element_text(size=8,))

grid.arrange(Lpri,nrow = 1, ncol=1)

```
Le graphique ci-dessus montre qu'il n'y a pas de relation linéaire entre le moment de la vente de la maison et le logarithme du prix obtenu. En effet, peu importe la date, le logarithme du prix semble distribué normalement et la variance des obseravations est constantes dans le temps. Il est intéressant de remarquer que les transactions sont fort probablement regroupées par semaine (lundi au vendredi) dû à l'horaire des bureaux de notaire, ce qui veut dire qu'aucune ou peu de transactions sont conclues le week-end.
\subsubsection{Variables bedrooms, bathrooms et floors}
```{r echo=FALSE, message=FALSE,fig.pos='H', fig.height=6, fig.width=6, fig.align="center"}
library(gridExtra)

bed <- ggplot(donnees, aes(x=factor(bedrooms), y=log(price))) + geom_boxplot() + 
  ggtitle("Effet du nombre de chambres sur le prix de vente d'une maison") +
  xlab("Nombre de chambres") + ylab("Logarithme du prix de vente") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size = 6), axis.title = element_text(size=6))

bath <- ggplot(donnees, aes(x=factor(round(bathrooms)), y=log(price))) + geom_boxplot() + #Floor ou round ici
  ggtitle("Effet du nombre de salles de bain sur le prix de vente d'une maison") +
  xlab("Nombre de salles de bain") + ylab("Logarithme du prix de vente") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size = 6), axis.title = element_text(size=6))

flo <- ggplot(donnees, aes(x=factor(floors), y=log(price))) + geom_boxplot() + 
  ggtitle("Effet du nombre d'étages sur le prix de vente d'une maison") +
  xlab("Nombre d'étages") + ylab("Logarithme du prix de vente") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size = 6), axis.title = element_text(size=6))

#grid.arrange(bed,bath,flo,nrow = 2, ncol=2)
grid.arrange(bed, bath, grid::nullGrob(), flo, grid::nullGrob(),
                        layout_matrix = matrix(c(1,1,2,2,3,4,4,5), byrow = TRUE, ncol = 4))

```
Le constat général de ces trois graphiques est que plus ces variables prennent une valeur élevée, plus le logarithme du prix augmente. Il s'agit d'un constat assez intuitif, donc ce n'est pas surprenant. Un second constat est qu'il y a une plus grande volatilité pour de faibles valeurs de ces trois variables. En effet, cela est attribuable au fait qu'il y a un grand nombre d'observations pour de faibles valeurs. Pour les valeurs plus à droite dans les graphiques, c'est plus dure d'analyser, car les cas sont beaucoup plus rares. Le dernier constat à relever est au niveau de la variable *bathrooms*. À l'aide du graphique de cette variable ci-haut, il est possible de constater que l'impact des salles de bains sur la variable réponse est plus important que l'impact des deux autres variables en raison de la pente plus prononcée. 

\subsubsection{Variables waterfront, view, condition et grade}
```{r echo=FALSE, message=FALSE,fig.pos='H', fig.height=6, fig.width=6, fig.align="center"}
library(gridExtra)


wat <- ggplot(donnees, aes(x=factor(waterfront), y=log(price))) + geom_boxplot() +
  ggtitle("Effet du bord de l'eau sur le prix de vente d'une maison") +
  xlab("Bord de l'eau") + ylab("Logarithme du prix de vente") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size = 6), axis.title = element_text(size=6))

vi <- ggplot(donnees, aes(x=factor(view), y=log(price))) + geom_boxplot() +
  ggtitle("Effet de la vue sur le prix de vente d'une maison") +
  xlab("Vue") + ylab("Logarithme du prix de vente") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size = 6), axis.title = element_text(size=6))

con <- ggplot(donnees, aes(x=factor(condition), y=log(price))) + geom_boxplot() +
  ggtitle("Effet de la condition de la maison sur le prix de vente d'une maison") +
  xlab("Condition de la maison") + ylab("Logarithme du prix de vente") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size = 6), axis.title = element_text(size=6))

gra <- ggplot(donnees, aes(x=factor(grade), y=log(price))) + geom_boxplot() +
  ggtitle("Effet de la qualité de la construction sur le prix de vente d'une maison") +
  xlab("Qualité de la construction") + ylab("Logarithme du prix de vente") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size = 6), axis.title = element_text(size=6))

grid.arrange(wat,vi,con,gra,nrow = 2, ncol=2)

```
\subsubsection{Variables de superficie}
```{r echo=FALSE, message=FALSE,fig.pos='H', fig.height=6, fig.width=6, fig.align="center"}
library(gridExtra)


#a <- ggplot(donnees, aes(x=log(sqft_living), y=log(price), col = reno)) + geom_point(alpha=0.4) +
 # ggtitle("Effet de la superficie habitable sur le prix de vente d'une maison") +
  #xlab("Superficie habitable (Pieds carrés)") + ylab("Logarithme du prix de vente") +
  #theme_bw() +
  #theme(plot.title = element_text(hjust = 0.5, size = 6), axis.title = element_text(size=6))

b <- ggplot(donnees, aes(x=log(sqft_lot), y=log(price))) + geom_point(alpha=0.4) +
  ggtitle("Effet de la superficie du terrain sur le prix de vente d'une maison") +
  xlab("Superficie du terrain (Pieds carrés)") + ylab("Logarithme du prix de vente") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size = 6), axis.title = element_text(size=6))

c <- ggplot(donnees, aes(x=log(sqft_above), y=log(price))) + geom_point(alpha=0.4) +
  ggtitle("Effet de la superficie des étages supérieurs sur le prix de vente d'une maison") +
  xlab("Superficie des étages supérieurs (Pieds carrés)") + ylab("Logarithme du prix de vente") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size = 6), axis.title = element_text(size=6))

d <- ggplot(donnees[!donnees$sqft_basement ==0,], aes(x=log(sqft_basement), y=log(price))) + geom_point(alpha=0.4) +
  ggtitle("Effet de la superficie du sous-sol sur le prix de vente d'une maison") +
  xlab("Superficie du sous-sol") + ylab("Logarithme du prix de vente") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size = 6), axis.title = element_text(size=6))

#e <- ggplot(donnees, aes(x=log(sqft_living15), y=log(price))) + geom_point(alpha=0.4) +
 # ggtitle("Effet de la superficie habitable du voisinage sur le prix de vente d'une maison") +
  #xlab("Superficie habitable du voisinage (Pieds carrés)") + ylab("Logarithme du prix de vente") +
  #theme_bw() +
  #theme(plot.title = element_text(hjust = 0.5, size = 6), axis.title = element_text(size=6))

f <- ggplot(donnees, aes(x=log(sqft_lot15), y=log(price))) + geom_point(alpha=0.4) +
  ggtitle("Effet de la superficie du terrain du voisinage sur le prix de vente d'une maison") +
  xlab("Superficie du terrain du voisinage (Pieds carrés)") + ylab("Logarithme du prix de vente") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size = 6), axis.title = element_text(size=6))


#grid.arrange(a,b,c,d,e,f,nrow = 3, ncol=2)
grid.arrange(b,c,d,f,nrow = 3, ncol=2)
```
\subsubsection{Variables age, reno et expensive area}
```{r echo=FALSE, message=FALSE,fig.pos='H', fig.height=4.5, fig.width=6, fig.align="center"}
library(gridExtra)


a <- ggplot(donnees, aes(x=age, y=log(price))) + geom_point(alpha=0.4) + 
  ggtitle("Effet de l'âge de la construction sur le prix de vente d'une maison") +
  xlab("Âge de la construction") + ylab("Logarithme du prix de vente") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size = 6), axis.title = element_text(size=6))

b <- ggplot(donnees, aes(x=reno, y=log(price))) + geom_boxplot() + coord_flip() +
  ggtitle("Effet des rénovations sur le prix de vente d'une maison") +
  xlab("Rénovations") + ylab("Logarithme du prix de vente") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size = 6), axis.title = element_text(size=6))

c <- ggplot(donnees, aes(x=factor(expensive_area), y=log(price))) + geom_boxplot() +
  ggtitle("Effet de la localisation sur le prix de vente d'une maison") +
  xlab("Localisation") + ylab("Logarithme du prix de vente") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size = 6), axis.title = element_text(size=6))


#grid.arrange(a,b,c,nrow = 2, ncol=2)
grid.arrange(b, c, grid::nullGrob(), a, grid::nullGrob(),
                        layout_matrix = matrix(c(1,1,2,2,3,4,4,5), byrow = TRUE, ncol = 4))

```

\newpage
\section{Création de variables explicatives}
D'après les données accessibles, il a semblé pertinent d'en utiliser certaines afin de créer d'autres variables explicatives qui seront plus utiles afin de déterminer le prix de vente des maisons de King County.

La première qui a été créée est celle de l'âge de la maison (*age*). Initialement, le jeu de données permettait d'obtenir la date de vente de la maison grâce à la variable *date* et l'année de construction de la maison grâce à la variable *yr_built*. À l'aide de ces deux variables, il est donc facile d'obtenir l'âge de la maison, soit le nombre d'années depuis qu'elle a été construite avant la vente de celle-ci. Analyser l'âge de la maison est plus facile qu'analyser deux dates prises séparement. Combiné ensemble ces deux dates crée un variable numérique discrète plus utile pour en déduire le prix d'une maison. En d'autres mots, cette varaible expliquera mieux les patrons de réponse.
**correct Sam? besoin de ta validation**

La deuxième variable qui a été créée est celle à savoir si la maison a été rénové ou non depuis sa construction, elle a été nommé *reno*. À prime abord, il a été testé si cette nouvelle variable ne devrait pas plutôt être catégorielle ordinale avec des catégories allant de *10 ans et moins* pour les maisons ayant eu une rénovation dans les $10$ années précédant leur vente, *10 ans et plus* pour les maisons ayant eu une rénovation il y a $10$ années ou plus et *Jamais rénové* pour les maisons n'ayant jamais été rénovées depuis leur construction. Par contre, après une analyse plus poussée, les catégories autres que celle *Jamais rénové* affichait une moyenne et une médiane similaire les uns entre les autres. Les séparer en plusieurs catégories semblent donc désuet, c'est pourquoi au final, la variable *réno* prend comme valeur $1$ si la maison a déjà été rénové depuis sa construction ou $0$ si elle n'a jamais été rénové.

La dernière variable créée est celle représentant la région la plus coûteuse (*expensive_area*). En effet, les variables réprésentant la latitude et la longitude de la maison sur la carte thermique ci-dessous (**comments:faire référence ex. figure 3**) indique la position de la maison sur la planète Terre. En utilisant toutes ces données de position des maisons, il est alors facile de les situées sur une carte de la région de King County, la région à l'étude dans ce rapport. Voici d'ailleurs un aperçu des positions de chaque maison vendue à King County.
```{r echo=FALSE, message=FALSE,fig.pos='H', fig.height=5, fig.width=5, fig.align="center", warning=FALSE}
library(ggmap)
register_google(key = "AIzaSyDR2ob6a6HSgsBhZkN -k0QNVeJT3uio4Wg") 

map<-get_map(location = c(left = min(donnees$long), bottom = min(donnees$lat), right = max(donnees$long), top = max(donnees$lat)))
xmin <-  -122.4
xmax <-  -122
ymin <-  47.5
ymax <-  47.72

ggmap(map, extent = "device") + stat_summary_2d(data = donnees ,
                                                aes(x = long, y = lat, z = log(price)),
                                                fun = mean, alpha = 0.6, bins = 100) + 
    scale_fill_gradient(name = "Log(Prix)", low = "green", high = "red") + ggtitle("Position des maisons vendues de King County")
```
En regardant la carte thermique affichée ci-dessus, il est possible de voir qu'une bonne partie des maisons les plus couteuses se situe au nord-ouest de la région, tout près de l'eau. Cette région semble être la zone urbaine. Il est d'ailleurs possible d'identifier la région la plus couteuse en allant chercher les coordonnées des bonnes latitudes et longitudes.

```{r echo=FALSE, message=FALSE,fig.pos='H', fig.height=5, fig.width=5, fig.align="center", warning=FALSE}
ggmap(map, extent = "device") + stat_summary_2d(data = donnees ,
                                                aes(x = long, y = lat, z = log(price)),
                                                fun = mean, alpha = 0.6, bins = 100) + 
    scale_fill_gradient(name = "Log(Prix)", low = "green", high = "red")+
    annotate("rect", xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax, colour="black", lty = 1, lwd = 1.3, alpha = 0) +
    annotate("text", x= -122.2, y = 47.6, label = "Zone urbaine")+ ggtitle("Position des maisons vendues de King County ")
```
La variable de la région la plus couteuse est une variable catégorielle qui renvoie $1$ lorsque la maison est située dans la zone urbaine et renvoie $0$ lorsque la maison ne se situe pas dans la zone urbaine.

\newpage
\section{Réduction de la dimensionalité}
```{r echo=FALSE, message=FALSE,fig.pos='H', fig.height=5, fig.width=5, fig.align="center", warning=FALSE}
donnees2 <- donnees[,-c(which(colnames(donnees)=="yr_built"), which(colnames(donnees)=="yr_renovated"), 
                       which(colnames(donnees)=="lat"), which(colnames(donnees)=="long"), which(colnames(donnees)=="date"))]
donnees2_test <- donnees2

#### ACP ####
library(FactoMineR)

#vrai ACP
acp <- PCA(donnees2[,c(-which(names(donnees2)=="reno"))],graph = F)
```
Il se trouve que malgré tout le prétraitement des données et l'analyse univariée et bivariée de celles-ci, on se retrouve avec un jeu de données contenant `r ncol(donnees2)` variables différentes.





\newpage
\section{Conclusion}

\newpage
\section{Bibliographie}

1. Kaggle (2017). House sales in King County, USA. Récupéré de https://www.kaggle.com/harlfoxem/housesalesprediction.

\newpage
\section{Annexe}
— **Le nom du jeu de données**

kc_house_sales (House sales in King County, USA)

— **La source**

https://www.kaggle.com/harlfoxem/housesalesprediction

— **Une brève description des données (environ deux phrases)**

Cet ensemble de données contient les prix de vente des maisons pour « King County », qui comprend Seattle. Il comprend les maisons vendues entre mai 2014 et mai 2015.

— **La variable réponse et son type**

« House sales » (prix de vente des maisons) -Variable numérique continue

— **La mesure d’exposition (s’il n’y en a pas, le mentionner)**

Il n’y en a pas

— **Cinq variables explicatives et leur type**

Bedrooms : Nombre de chambres – Variable numérique discrète

Bathrooms : Nombre de salles de bain (0.5 est une toilette sans douche) - Variable numérique continue

sqft_living : Superficie de l’espace de vie en pieds carrés - Variable numérique discrète

sqft_lot : Superficie du terrain en pieds carrés - Variable numérique discrète

floors : Nombre d'étages - Variable numérique continue

et plusieurs autres variables bien sur!

— **La taille du jeu de données (nombre d’observations et de variables)**

21 613 lignes pour 21 colonnes (variables)

